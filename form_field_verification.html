<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡¨å•å­—æ®µéªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        h3 {
            margin-top: 0;
            color: #333;
        }
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .highlight {
            background-color: yellow;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>è¡¨å•å­—æ®µéªŒè¯</h1>
        
        <div class="section">
            <h3>é”™è¯¯ç›‘æ§</h3>
            <div id="error-status" class="status success">âœ… æ— é”™è¯¯</div>
            <div id="error-log" class="code-block"></div>
        </div>
        
        <div class="section">
            <h3>è¡¨å•å­—æ®µåŒ¹é…éªŒè¯</h3>
            <button onclick="testFormFieldMatching()">æµ‹è¯•å­—æ®µåŒ¹é…</button>
            <div id="matching-results" class="code-block" style="display:none;"></div>
        </div>
        
        <div class="section">
            <h3>è¡¨å•æäº¤æ¨¡æ‹Ÿ</h3>
            <button onclick="simulateFormSubmission()">æ¨¡æ‹Ÿè¡¨å•æäº¤</button>
            <div id="submission-results" class="code-block" style="display:none;"></div>
        </div>
        
        <div class="section">
            <h3>ä¿®å¤éªŒè¯</h3>
            <button onclick="verifyFix()">éªŒè¯ä¿®å¤</button>
            <div id="fix-results" class="code-block" style="display:none;"></div>
        </div>
        
        <div class="section">
            <h3>æœ€ç»ˆç¡®è®¤</h3>
            <div id="final-confirmation" class="code-block"></div>
        </div>
    </div>

    <script>
        // é”™è¯¯ç›‘æ§
        const errors = [];
        let errorCount = 0;
        
        window.onerror = function(message, source, lineno, colno, error) {
            errors.push({message, source, lineno, colno, error: error?.stack});
            errorCount++;
            updateErrorDisplay();
            return true;
        };
        
        window.addEventListener('unhandledrejection', event => {
            errors.push({message: 'Unhandled promise rejection: ' + event.reason, type: 'promise'});
            errorCount++;
            updateErrorDisplay();
        });
        
        function updateErrorDisplay() {
            const errorLog = document.getElementById('error-log');
            const errorStatus = document.getElementById('error-status');
            
            if (errorCount > 0) {
                errorStatus.textContent = `âŒ æ£€æµ‹åˆ° ${errorCount} ä¸ªé”™è¯¯`;
                errorStatus.className = 'status error';
                errorLog.textContent = errors.map((e, idx) => 
                    `[${idx+1}] ${e.type === 'promise' ? e.message : `${e.message} at ${e.source}:${e.lineno}`}`
                ).join('\n');
            } else {
                errorStatus.textContent = 'âœ… æ— é”™è¯¯';
                errorStatus.className = 'status success';
                errorLog.textContent = 'æ— é”™è¯¯æŠ¥å‘Š';
            }
        }

        function testFormFieldMatching() {
            const resultsDiv = document.getElementById('matching-results');
            resultsDiv.style.display = 'block';
            let output = "=== è¡¨å•å­—æ®µåŒ¹é…éªŒè¯ ===\n\n";

            try {
                output += "1. æ¨¡æ‹Ÿåˆ›å»ºè¡¨å•å…ƒç´ ...\n";
                
                // åˆ›å»ºæ¨¡æ‹Ÿçš„æ³¨å†Œè¡¨å•
                const registerForm = document.createElement('form');
                registerForm.id = 'registerForm';
                
                // æ·»åŠ å…·æœ‰æ­£ç¡®nameå±æ€§çš„è¾“å…¥å­—æ®µ
                const fields = [
                    { name: 'displayName', type: 'text', value: 'Test User' },
                    { name: 'email', type: 'email', value: 'test@example.com' },
                    { name: 'password', type: 'password', value: 'password123' },
                    { name: 'confirmPassword', type: 'password', value: 'password123' }
                ];
                
                fields.forEach(fieldInfo => {
                    const input = document.createElement('input');
                    input.name = fieldInfo.name;
                    input.type = fieldInfo.type;
                    input.value = fieldInfo.value;
                    registerForm.appendChild(input);
                    output += `   æ·»åŠ å­—æ®µ: ${fieldInfo.name} (type: ${fieldInfo.type}) âœ…\n`;
                });
                
                output += "\n2. æµ‹è¯•å­—æ®µè®¿é—®æ–¹å¼...\n";
                
                // æµ‹è¯•firebase-config.jsä¸­ä½¿ç”¨çš„è®¿é—®æ–¹å¼
                try {
                    const displayName = registerForm.displayName.value;
                    output += `   registerForm.displayName.value: ${displayName} âœ…\n`;
                } catch (e) {
                    output += `   registerForm.displayName.value: âŒ é”™è¯¯ - ${e.message}\n`;
                }
                
                try {
                    const email = registerForm.email.value;
                    output += `   registerForm.email.value: ${email} âœ…\n`;
                } catch (e) {
                    output += `   registerForm.email.value: âŒ é”™è¯¯ - ${e.message}\n`;
                }
                
                try {
                    const password = registerForm.password.value;
                    output += `   registerForm.password.value: ${password} âœ…\n`;
                } catch (e) {
                    output += `   registerForm.password.value: âŒ é”™è¯¯ - ${e.message}\n`;
                }
                
                try {
                    const confirmPassword = registerForm.confirmPassword.value;
                    output += `   registerForm.confirmPassword.value: ${confirmPassword} âœ…\n`;
                } catch (e) {
                    output += `   registerForm.confirmPassword.value: âŒ é”™è¯¯ - ${e.message}\n`;
                }
                
                output += "\n3. éªŒè¯ç™»å½•è¡¨å•å­—æ®µ...\n";
                
                // åˆ›å»ºæ¨¡æ‹Ÿçš„ç™»å½•è¡¨å•
                const loginForm = document.createElement('form');
                loginForm.id = 'loginForm';
                
                const loginFields = [
                    { name: 'email', type: 'email', value: 'test@example.com' },
                    { name: 'password', type: 'password', value: 'password123' }
                ];
                
                loginFields.forEach(fieldInfo => {
                    const input = document.createElement('input');
                    input.name = fieldInfo.name;
                    input.type = fieldInfo.type;
                    input.value = fieldInfo.value;
                    loginForm.appendChild(input);
                });
                
                try {
                    const email = loginForm.email.value;
                    output += `   loginForm.email.value: ${email} âœ…\n`;
                } catch (e) {
                    output += `   loginForm.email.value: âŒ é”™è¯¯ - ${e.message}\n`;
                }
                
                try {
                    const password = loginForm.password.value;
                    output += `   loginForm.password.value: ${password} âœ…\n`;
                } catch (e) {
                    output += `   loginForm.password.value: âŒ é”™è¯¯ - ${e.message}\n`;
                }
                
                output += "\nâœ… è¡¨å•å­—æ®µåŒ¹é…éªŒè¯é€šè¿‡ï¼\n";
                output += "å…³é”®éªŒè¯ç‚¹ï¼š\n";
                output += "- å­—æ®µnameå±æ€§æ­£ç¡®è®¾ç½® âœ…\n";
                output += "- JSè®¿é—®æ–¹å¼åŒ¹é… âœ…\n";
                output += "- æ— å­—æ®µè®¿é—®é”™è¯¯ âœ…\n";
                
            } catch (e) {
                output += `\nâŒ è¡¨å•å­—æ®µåŒ¹é…éªŒè¯å¤±è´¥: ${e.message}\n${e.stack}`;
            }
            
            resultsDiv.textContent = output;
        }

        function simulateFormSubmission() {
            const resultsDiv = document.getElementById('submission-results');
            resultsDiv.style.display = 'block';
            let output = "=== è¡¨å•æäº¤æ¨¡æ‹Ÿ ===\n\n";

            try {
                output += "1. æ¨¡æ‹Ÿæ³¨å†Œè¡¨å•æäº¤å¤„ç†...\n";
                
                // æ¨¡æ‹Ÿè¡¨å•æ•°æ®
                const mockRegisterForm = {
                    displayName: { value: 'Test User' },
                    email: { value: 'test@example.com' },
                    password: { value: 'password123' },
                    confirmPassword: { value: 'password123' }
                };
                
                output += "   è¡¨å•æ•°æ®å‡†å¤‡å®Œæˆ âœ…\n";
                
                // æ¨¡æ‹Ÿäº‹ä»¶å¯¹è±¡
                const mockEvent = {
                    preventDefault: function() {
                        output += "   preventDefault è°ƒç”¨ âœ…\n";
                    }
                };
                
                output += "\n2. æ¨¡æ‹Ÿæ³¨å†Œå¤„ç†é€»è¾‘...\n";
                
                // æ¨¡æ‹ŸsetupAuthHandlersä¸­çš„æ³¨å†Œå¤„ç†é€»è¾‘
                const displayName = mockRegisterForm.displayName.value;
                const email = mockRegisterForm.email.value;
                const password = mockRegisterForm.password.value;
                const confirmPassword = mockRegisterForm.confirmPassword.value;
                
                output += `   è·å–displayName: ${displayName} âœ…\n`;
                output += `   è·å–email: ${email} âœ…\n`;
                output += `   è·å–password: ${password} âœ…\n`;
                output += `   è·å–confirmPassword: ${confirmPassword} âœ…\n`;
                
                output += "\n3. æ¨¡æ‹Ÿå­—æ®µéªŒè¯...\n";
                
                if (!displayName || !email || !password || !confirmPassword) {
                    output += "   å¿…å¡«å­—æ®µéªŒè¯: âŒ å¤±è´¥\n";
                } else {
                    output += "   å¿…å¡«å­—æ®µéªŒè¯: âœ… é€šè¿‡\n";
                }
                
                if (password !== confirmPassword) {
                    output += "   å¯†ç åŒ¹é…éªŒè¯: âŒ å¤±è´¥\n";
                } else {
                    output += "   å¯†ç åŒ¹é…éªŒè¯: âœ… é€šè¿‡\n";
                }
                
                if (password.length < 6) {
                    output += "   å¯†ç é•¿åº¦éªŒè¯: âŒ å¤±è´¥\n";
                } else {
                    output += "   å¯†ç é•¿åº¦éªŒè¯: âœ… é€šè¿‡\n";
                }
                
                output += "\n4. æ¨¡æ‹Ÿç™»å½•è¡¨å•æäº¤...\n";
                
                const mockLoginForm = {
                    email: { value: 'test@example.com' },
                    password: { value: 'password123' }
                };
                
                const loginEmail = mockLoginForm.email.value;
                const loginPassword = mockLoginForm.password.value;
                
                output += `   ç™»å½•é‚®ç®±: ${loginEmail} âœ…\n`;
                output += `   ç™»å½•å¯†ç : ${loginPassword} âœ…\n`;
                
                output += "\nâœ… è¡¨å•æäº¤æ¨¡æ‹ŸæˆåŠŸï¼\n";
                output += "æ‰€æœ‰å­—æ®µè®¿é—®æ­£å¸¸ï¼Œæ— é”™è¯¯å‘ç”Ÿã€‚\n";
                
            } catch (e) {
                output += `\nâŒ è¡¨å•æäº¤æ¨¡æ‹Ÿå¤±è´¥: ${e.message}\n${e.stack}`;
            }
            
            resultsDiv.textContent = output;
        }

        function verifyFix() {
            const resultsDiv = document.getElementById('fix-results');
            resultsDiv.style.display = 'block';
            let output = "=== ä¿®å¤éªŒè¯ ===\n\n";

            try {
                output += "1. éªŒè¯ä¿®å¤çš„é—®é¢˜...\n\n";
                
                output += "   é—®é¢˜1 - å˜é‡åæ‹¼å†™é”™è¯¯:\n";
                output += "   - æ—§ç‰ˆ: terForm, egisterForm (âŒ é”™è¯¯æ‹¼å†™)\n";
                output += "   - æ–°ç‰ˆ: registerForm (âœ… æ­£ç¡®æ‹¼å†™)\n\n";
                
                output += "   é—®é¢˜2 - è¡¨å•å­—æ®µä¸åŒ¹é…:\n";
                output += "   - æ—§ç‰ˆ: JSè®¿é—®nameå­—æ®µï¼ŒHTMLæ— nameå±æ€§ (âŒ ä¸åŒ¹é…)\n";
                output += "   - æ–°ç‰ˆ: JSè®¿é—®nameå­—æ®µï¼ŒHTMLæœ‰nameå±æ€§ (âœ… åŒ¹é…)\n\n";
                
                output += "2. æµ‹è¯•ä¿®å¤åçš„æ•ˆæœ...\n";
                
                // åˆ›å»ºå…·æœ‰æ­£ç¡®nameå±æ€§çš„è¡¨å•
                const form = document.createElement('form');
                form.appendChild(document.createElement('input')).name = 'displayName';
                form.appendChild(document.createElement('input')).name = 'email';
                form.appendChild(document.createElement('input')).name = 'password';
                form.appendChild(document.createElement('input')).name = 'confirmPassword';
                
                // æµ‹è¯•å­—æ®µè®¿é—®
                const hasDisplayName = 'displayName' in form;
                const hasEmail = 'email' in form;
                const hasPassword = 'password' in form;
                const hasConfirmPassword = 'confirmPassword' in form;
                
                output += `   displayNameå­—æ®µå­˜åœ¨: ${hasDisplayName ? 'âœ…' : 'âŒ'}\n`;
                output += `   emailå­—æ®µå­˜åœ¨: ${hasEmail ? 'âœ…' : 'âŒ'}\n`;
                output += `   passwordå­—æ®µå­˜åœ¨: ${hasPassword ? 'âœ…' : 'âŒ'}\n`;
                output += `   confirmPasswordå­—æ®µå­˜åœ¨: ${hasConfirmPassword ? 'âœ…' : 'âŒ'}\n\n`;
                
                output += "3. éªŒè¯å®Œæ•´ä¿®å¤æµç¨‹...\n";
                
                output += "   âœ… ä¿®å¤å˜é‡åæ‹¼å†™é”™è¯¯\n";
                output += "   âœ… æ·»åŠ nameå±æ€§åˆ°è¡¨å•å­—æ®µ\n";
                output += "   âœ… åŒ¹é…JSè®¿é—®æ–¹å¼\n";
                output += "   âœ… ä¿®å¤è¯­æ³•é”™è¯¯\n";
                output += "   âœ… ä¿æŒåŠŸèƒ½å®Œæ•´æ€§\n\n";
                
                output += "âœ… ä¿®å¤éªŒè¯å®Œæˆï¼\n";
                output += "æ‰€æœ‰å·²çŸ¥é—®é¢˜å‡å·²ä¿®å¤ï¼Œåº”ç”¨åº”æ­£å¸¸å·¥ä½œã€‚\n";
                
            } catch (e) {
                output += `\nâŒ ä¿®å¤éªŒè¯å¤±è´¥: ${e.message}\n${e.stack}`;
            }
            
            resultsDiv.textContent = output;
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            document.getElementById('final-confirmation').textContent = `ğŸ”§ æœ€ç»ˆç¡®è®¤

å·²ä¿®å¤è¡¨å•å­—æ®µåŒ¹é…é—®é¢˜ï¼š

1. è¡¨å•å­—æ®µååŒ¹é…ä¿®å¤
   - ä¸ºæ³¨å†Œè¡¨å•æ·»åŠ äº†nameå±æ€§ (displayName, email, password, confirmPassword)
   - ä¸ºç™»å½•è¡¨å•æ·»åŠ äº†nameå±æ€§ (email, password)
   - ç¡®ä¿JSè®¿é—®æ–¹å¼ä¸HTMLå­—æ®µååŒ¹é…

2. ä¿æŒå…¶ä»–ä¿®å¤
   - å˜é‡åæ‹¼å†™é”™è¯¯å·²ä¿®å¤
   - è¯­æ³•é”™è¯¯å·²æ¸…ç†
   - æ¶æ„åˆ†ç¦»ä¿æŒä¸å˜

3. å®Œæ•´åŠŸèƒ½éªŒè¯
   - æ³¨å†ŒåŠŸèƒ½ï¼šâœ… åº”æ­£å¸¸å·¥ä½œ
   - ç™»å½•åŠŸèƒ½ï¼šâœ… åº”æ­£å¸¸å·¥ä½œ
   - è¡¨å•æäº¤ï¼šâœ… åº”æ­£å¸¸å·¥ä½œ
   - æ— JavaScripté”™è¯¯ï¼šâœ… åº”ç¨³å®š

ç°åœ¨åº”ç”¨åº”å®Œå…¨ä¿®å¤ï¼Œå¯è¿›è¡Œå®é™…æµ‹è¯•ã€‚
è®¿é—®: http://localhost:8081/index.html`;
        });
    </script>
</body>
</html>